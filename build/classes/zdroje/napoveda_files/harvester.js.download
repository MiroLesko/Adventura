(function(w,d,u,s,wt){


	if (window['wt'] && window['wt'].q) {
		StankaViewer = {
			ajaxCallTimer: 10,
			data: window['wt'].q[0][0],
			ajaxCallTimeout: null,
			url: 'https://harvester.hnonline.sk/api/v1/heartbeat',

			init: function() {
				StankaViewer.work(StankaViewer.url, StankaViewer.data, StankaViewer.ajaxCallTimer);
			},

			serialize: function(obj) {
				var str = [];
				for(var p in obj)
					if (obj.hasOwnProperty(p)) {
						str.push(encodeURIComponent(p) + "=" + encodeURIComponent(obj[p]));
					}
				return str.join("&");
			},

			work: function(url, data, interval) {
				clearTimeout(StankaViewer.ajaxCallTimeout);

				var request = new XMLHttpRequest();

				// submit request
				request.open('POST', encodeURI(url), true);

				// request load
				request.onload = function() {
					if (request.status >= 200 && request.status < 400) { // success
						var response = JSON.parse(request.responseText);

						if (response.token) {
							StankaViewer.data = {
								"token": response.token
							};
						}

						StankaViewer.ajaxCallTimeout = setTimeout(function(){							
							StankaViewer.work(StankaViewer.url, StankaViewer.data, StankaViewer.ajaxCallTimer);
						}, interval * 1000);
					}
					else { // error
						StankaViewer.errors(StankaViewer.ajaxCallTimer);
					}
				};

				// request error
				request.onerror = function() { // error
					StankaViewer.errors(StankaViewer.ajaxCallTimer);
				};

				// send data
				request.send(StankaViewer.serialize(StankaViewer.data));
			},

			cancelRequests: function() {
				clearTimeout(StankaViewer.ajaxCallTimeout);
				
				var request = new XMLHttpRequest();
				
				request.open('POST', encodeURI(StankaViewer.url), true); // submit request
				request.send(StankaViewer.serialize(StankaViewer.data));

				StankaViewer.data = window['wt'].q[0][0];
			},

			errors: function(interval) {
				StankaViewer.cancelRequests();

				setTimeout(function() {
					StankaViewer.work(StankaViewer.url, StankaViewer.data, StankaViewer.ajaxCallTimer);
				}, interval * 10000);
			}
		}
	}

    var p=window['st'].q[0][0];
    if(!p||!p.resource)return;
    var s = [];
    var r=new XMLHttpRequest();
    for(var i in p)if(p.hasOwnProperty(i))s.push(encodeURIComponent(i)+'='+encodeURIComponent(p[i]));
    s=s.join('&');
    r.open('POST',u,true);
    r.setRequestHeader('Content-Type','application/x-www-form-urlencoded; charset=UTF-8');
    r.send(s);
})(window,document,'https://harvester.hnonline.sk/api/v1/track','st');