function arrayUnique(e){for(var t=e.concat(),s=0;s<t.length;++s)for(var r=s+1;r<t.length;++r)t[s].id===t[r].id&&t.splice(s,1);return t}function addHeadScript(e,t){insertedScriptTags.indexOf(e+t)==-1&&(insertedScriptTags.push(e+t),setTimeout(function(){var s=document.getElementsByTagName("head")[0],r=document.createElement("script");r.type="text/javascript",r.src=e+"?no_cache="+t,r.async="",r.defer="",s.appendChild(r)},1e3))}function minuta(e,t){t&&!t.refreshInterval&&(t.refreshInterval=1e4),React.render(React.createElement(TopicBox,t),document.getElementById(e))}!function(e,t,s){"undefined"!=typeof module&&module.exports?module.exports=s():"function"==typeof define&&define.amd?define(s):t[e]=s()}("reqwest",this,function(){function succeed(e){var t=protocolRe.exec(e.url);return t=t&&t[1]||context.location.protocol,httpsRe.test(t)?twoHundo.test(e.request.status):!!e.request.response}function handleReadyState(e,t,s){return function(){return e._aborted?s(e.request):e._timedOut?s(e.request,"Request is aborted: timeout"):void(e.request&&4==e.request[readyState]&&(e.request.onreadystatechange=noop,succeed(e)?t(e.request):s(e.request)))}}function setHeaders(e,t){var s,r=t.headers||{};r.Accept=r.Accept||defaultHeaders.accept[t.type]||defaultHeaders.accept["*"];var a="undefined"!=typeof FormData&&t.data instanceof FormData;t.crossOrigin||r[requestedWith]||(r[requestedWith]=defaultHeaders.requestedWith),r[contentType]||a||(r[contentType]=t.contentType||defaultHeaders.contentType);for(s in r)r.hasOwnProperty(s)&&"setRequestHeader"in e&&e.setRequestHeader(s,r[s])}function setCredentials(e,t){"undefined"!=typeof t.withCredentials&&"undefined"!=typeof e.withCredentials&&(e.withCredentials=!!t.withCredentials)}function generalCallback(e){lastValue=e}function urlappend(e,t){return e+(/\?/.test(e)?"&":"?")+t}function handleJsonp(e,t,s,r){var a=uniqid++,i=e.jsonpCallback||"callback",n=e.jsonpCallbackName||reqwest.getcallbackPrefix(a),o=new RegExp("((^|\\?|&)"+i+")=([^&]+)"),l=r.match(o),p=doc.createElement("script"),c=0,u=navigator.userAgent.indexOf("MSIE 10.0")!==-1;return l?"?"===l[3]?r=r.replace(o,"$1="+n):n=l[3]:r=urlappend(r,i+"="+n),context[n]=generalCallback,p.type="text/javascript",p.src=r,p.async=!0,"undefined"==typeof p.onreadystatechange||u||(p.htmlFor=p.id="_reqwest_"+a),p.onload=p.onreadystatechange=function(){return!(p[readyState]&&"complete"!==p[readyState]&&"loaded"!==p[readyState]||c)&&(p.onload=p.onreadystatechange=null,p.onclick&&p.onclick(),t(lastValue),lastValue=void 0,head.removeChild(p),void(c=1))},head.appendChild(p),{abort:function(){p.onload=p.onreadystatechange=null,s({},"Request is aborted: timeout",{}),lastValue=void 0,head.removeChild(p),c=1}}}function getRequest(e,t){var s,r=this.o,a=(r.method||"GET").toUpperCase(),i="string"==typeof r?r:r.url,n=r.processData!==!1&&r.data&&"string"!=typeof r.data?reqwest.toQueryString(r.data):r.data||null,o=!1;return"jsonp"!=r.type&&"GET"!=a||!n||(i=urlappend(i,n),n=null),"jsonp"==r.type?handleJsonp(r,e,t,i):(s=r.xhr&&r.xhr(r)||xhr(r),s.open(a,i,r.async!==!1),setHeaders(s,r),setCredentials(s,r),context[xDomainRequest]&&s instanceof context[xDomainRequest]?(s.onload=e,s.onerror=t,s.onprogress=function(){},o=!0):s.onreadystatechange=handleReadyState(this,e,t),r.before&&r.before(s),o?setTimeout(function(){s.send(n)},200):s.send(n),s)}function Reqwest(e,t){this.o=e,this.fn=t,init.apply(this,arguments)}function setType(e){if(null!==e)return e.match("json")?"json":e.match("javascript")?"js":e.match("text")?"html":e.match("xml")?"xml":void 0}function init(o,fn){function complete(e){for(o.timeout&&clearTimeout(self.timeout),self.timeout=null;self._completeHandlers.length>0;)self._completeHandlers.shift()(e)}function success(resp){var type=o.type||resp&&setType(resp.getResponseHeader("Content-Type"));resp="jsonp"!==type?self.request:resp;var filteredResponse=globalSetupOptions.dataFilter(resp.responseText,type),r=filteredResponse;try{resp.responseText=r}catch(e){}if(r)switch(type){case"json":try{resp=context.JSON?context.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML}for(self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp),self._successHandler(resp);self._fulfillmentHandlers.length>0;)resp=self._fulfillmentHandlers.shift()(resp);complete(resp)}function timedOut(){self._timedOut=!0,self.request.abort()}function error(e,t,s){for(e=self.request,self._responseArgs.resp=e,self._responseArgs.msg=t,self._responseArgs.t=s,self._erred=!0;self._errorHandlers.length>0;)self._errorHandlers.shift()(e,t,s);complete(e)}this.url="string"==typeof o?o:o.url,this.timeout=null,this._fulfilled=!1,this._successHandler=function(){},this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){timedOut()},o.timeout)),o.success&&(this._successHandler=function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push(function(){o.error.apply(o,arguments)}),o.complete&&this._completeHandlers.push(function(){o.complete.apply(o,arguments)}),this.request=getRequest.call(this,success,error)}function reqwest(e,t){return new Reqwest(e,t)}function normalize(e){return e?e.replace(/\r?\n/g,"\r\n"):""}function serial(e,t){var s,r,a,i,n=e.name,o=e.tagName.toLowerCase(),l=function(e){e&&!e.disabled&&t(n,normalize(e.attributes.value&&e.attributes.value.specified?e.value:e.text))};if(!e.disabled&&n)switch(o){case"input":/reset|button|image|file/i.test(e.type)||(s=/checkbox/i.test(e.type),r=/radio/i.test(e.type),a=e.value,(!(s||r)||e.checked)&&t(n,normalize(s&&""===a?"on":a)));break;case"textarea":t(n,normalize(e.value));break;case"select":if("select-one"===e.type.toLowerCase())l(e.selectedIndex>=0?e.options[e.selectedIndex]:null);else for(i=0;e.length&&i<e.length;i++)e.options[i].selected&&l(e.options[i])}}function eachFormElement(){var e,t,s=this,r=function(e,t){var r,a,i;for(r=0;r<t.length;r++)for(i=e[byTag](t[r]),a=0;a<i.length;a++)serial(i[a],s)};for(t=0;t<arguments.length;t++)e=arguments[t],/input|select|textarea/i.test(e.tagName)&&serial(e,s),r(e,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var e={};return eachFormElement.apply(function(t,s){t in e?(e[t]&&!isArray(e[t])&&(e[t]=[e[t]]),e[t].push(s)):e[t]=s},arguments),e}function buildParams(e,t,s,r){var a,i,n,o=/\[\]$/;if(isArray(t))for(i=0;t&&i<t.length;i++)n=t[i],s||o.test(e)?r(e,n):buildParams(e+"["+("object"==typeof n?i:"")+"]",n,s,r);else if(t&&"[object Object]"===t.toString())for(a in t)buildParams(e+"["+a+"]",t[a],s,r);else r(e,t)}var context=this;if("window"in context)var doc=document,byTag="getElementsByTagName",head=doc[byTag]("head")[0];else{var XHR2;try{XHR2=require("xhr2")}catch(ex){throw new Error("Peer dependency `xhr2` required! Please npm install xhr2")}}var httpsRe=/^http/,protocolRe=/(^\w+):\/\//,twoHundo=/^(20\d|1223)$/,readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",uniqid=0,callbackPrefix="reqwest_"+ +new Date,lastValue,xmlHttpRequest="XMLHttpRequest",xDomainRequest="XDomainRequest",noop=function(){},isArray="function"==typeof Array.isArray?Array.isArray:function(e){return e instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=function(e){if(e.crossOrigin===!0){var t=context[xmlHttpRequest]?new XMLHttpRequest:null;if(t&&"withCredentials"in t)return t;if(context[xDomainRequest])return new XDomainRequest;throw new Error("Browser does not support cross-origin requests")}return context[xmlHttpRequest]?new XMLHttpRequest:XHR2?new XHR2:new ActiveXObject("Microsoft.XMLHTTP")},globalSetupOptions={dataFilter:function(e){return e}};return Reqwest.prototype={abort:function(){this._aborted=!0,this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(e,t){return e=e||function(){},t=t||function(){},this._fulfilled?this._responseArgs.resp=e(this._responseArgs.resp):this._erred?t(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(e),this._errorHandlers.push(t)),this},always:function(e){return this._fulfilled||this._erred?e(this._responseArgs.resp):this._completeHandlers.push(e),this},fail:function(e){return this._erred?e(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(e),this},"catch":function(e){return this.fail(e)}},reqwest.serializeArray=function(){var e=[];return eachFormElement.apply(function(t,s){e.push({name:t,value:s})},arguments),e},reqwest.serialize=function(){if(0===arguments.length)return"";var e,t,s=Array.prototype.slice.call(arguments,0);return e=s.pop(),e&&e.nodeType&&s.push(e)&&(e=null),e&&(e=e.type),t="map"==e?serializeHash:"array"==e?reqwest.serializeArray:serializeQueryString,t.apply(null,s)},reqwest.toQueryString=function(e,t){var s,r,a=t||!1,i=[],n=encodeURIComponent,o=function(e,t){t="function"==typeof t?t():null==t?"":t,i[i.length]=n(e)+"="+n(t)};if(isArray(e))for(r=0;e&&r<e.length;r++)o(e[r].name,e[r].value);else for(s in e)e.hasOwnProperty(s)&&buildParams(s,e[s],a,o);return i.join("&").replace(/%20/g,"+")},reqwest.getcallbackPrefix=function(){return callbackPrefix},reqwest.compat=function(e,t){return e&&(e.type&&(e.method=e.type)&&delete e.type,e.dataType&&(e.type=e.dataType),e.jsonpCallback&&(e.jsonpCallbackName=e.jsonpCallback)&&delete e.jsonpCallback,e.jsonp&&(e.jsonpCallback=e.jsonp)),new Reqwest(e,t)},reqwest.ajaxSetup=function(e){e=e||{};for(var t in e)globalSetupOptions[t]=e[t]},reqwest});var insertedScriptTags=[],ItemContent=React.createClass({displayName:"ItemContent",render:function(){var e=!!this.props.text&&this.props.text.toString();if(e){for(var t,s=/<script(.*?)src="(.*?)"(.*?)><\/script>/g;null!==(t=s.exec(e));)t.index===s.lastIndex&&s.lastIndex++,t[2]&&addHeadScript(t[2],this.props.id);for(var t,s=/<script>([\s\S]*)<\/script>/g;null!==(t=s.exec(e));)t.index===s.lastIndex&&s.lastIndex++,t[1]&&(0,eval)(t[1]);this.props.callbacks&&this.props.callbacks.afterText&&(e+=this.props.callbacks.afterText(this.props.id,this.props.title,this.props.text)),e=React.createElement("span",{dangerouslySetInnerHTML:{__html:e}})}var r=null;return this.props.title&&(r=React.createElement("h1",null,this.props.title)),e||r||(r=null),React.createElement("div",null,r,e)}}),ItemBox=React.createClass({displayName:"ItemBox",render:function(){var e="";if(this.props.callbacks&&this.props.callbacks.afterItem){var t={__html:this.props.callbacks.afterItem(this.props.id,this.props.title,this.props.text)};e=React.createElement("span",{dangerouslySetInnerHTML:t})}var s=new Date(this.props.published_at),r=s.getHours()+":"+(s.getMinutes()<10?"0"+s.getMinutes():s.getMinutes()),a=[];this.props.is_highlight&&a.push("important");var i=null;this.props.add_header&&(i=React.createElement(DateHeaderBox,{date:s}));var n=React.createElement("div",{className:"dot"},React.createElement("div",null)),o=React.createElement("time",{dateTime:s.toISOString()},r);this.props.is_pinned&&(o=null,a.push("sticky"),n=null),this.props.is_published||a.push("hidden");var l=null;this.props.time_identifier&&(l=React.createElement("i",null," ",this.props.time_identifier));var p=null;if(this.props.show_controls){var c=this.props.edit_url+this.props.id,u=this.props.delete_url+this.props.id;p=React.createElement("nav",{className:"box-pager left"},React.createElement("a",{href:c,target:"_top"},"Upraviť "),React.createElement("a",{href:u,target:"_top",onclick:"return confirm('Naozaj checete vymazať záznam?')"},"Zmazať"))}return this.props.active_item==this.props.id&&a.push("active"),React.createElement("div",null,i,React.createElement("article",{className:a.join(" ")},n,React.createElement("div",null,o,l,React.createElement(ItemContent,{title:this.props.title,text:this.props.text,is_pinned:this.props.is_pinned,id:this.props.id,callbacks:this.props.callbacks}),p,e)))}}),DateHeaderBox=React.createClass({displayName:"DateHeaderBox",render:function(){var e=this.props.date.getDate()+"."+(this.props.date.getMonth()+1)+"."+this.props.date.getFullYear();return React.createElement("article",{className:"separator"},React.createElement("div",{className:"dot"},React.createElement("div",null)),React.createElement("time",{dateTime:this.props.date.toISOString()},e))}}),ItemListBox=React.createClass({displayName:"ItemListBox",render:function(){lastDate=null;var e=this.props.showDateHeader,t=this.props.showControls,s=this.props.editUrl,r=this.props.deleteUrl,a=this.props.callbacks,i=this.props.activeItem,n=this.props.items.map(function(n){itemDate=new Date(n.published_at);var o=!1;return null!=lastDate&&lastDate.getFullYear()==itemDate.getFullYear()&&lastDate.getMonth()==itemDate.getMonth()&&lastDate.getDate()==itemDate.getDate()||(o=!0),lastDate=itemDate,n.is_pinned&&(lastDate=null,o=!1),0==e&&(o=!1),React.createElement(ItemBox,{key:n.id,id:n.id,published_at:n.published_at,title:n.title,text:n.text,is_highlight:n.is_highlight,is_pinned:n.is_pinned,is_published:n.is_published,time_identifier:n.time_identifier,add_header:o,show_controls:t,edit_url:s,delete_url:r,callbacks:a,active_item:i})});return React.createElement("div",{className:"itemBox"},n)}}),RefreshBox=React.createClass({displayName:"RefreshBox",actualize:function(e){e.preventDefault(),this.props.onActualize()},render:function(){var e={},t="Aktualizovať";if(this.props.isLoading&&(e={opacity:"0.6"},t="Aktualizujem..."),0==this.props.showRefreshButton)return React.createElement("div",null);var s=parseInt(this.props.actualTime/1e3);return React.createElement("div",{className:"refresh",style:e},React.createElement("span",null,"automaticky o ",React.createElement("b",null,s)," s  "),React.createElement("button",{onClick:this.actualize},React.createElement("i",{className:"ico ico-refresh"})," ",t),React.createElement(MessageBox,{message:this.props.message,type:this.props.messageType}))}}),MessageBox=React.createClass({displayName:"MessageBox",render:function(){var e={display:"none"};return"error"==this.props.type&&(e={display:"block",color:"white",backgroundColor:"red",padding:"15px"}),"info"==this.props.type&&(e={display:"block",color:"black",backgroundColor:"yellow",padding:"15px"}),React.createElement("div",{style:e},React.createElement("div",null,this.props.message))}}),Pager=React.createClass({displayName:"Pager",handleNextClick:function(e){e.preventDefault(),document.getElementById("m-header").scrollIntoView(),this.props.onNext(this.props.nextLink)},handlePrevClick:function(e){e.preventDefault(),document.getElementById("m-header").scrollIntoView(),this.props.onPrev(this.props.prevLink)},render:function(){var e=null,t=null;return this.props.prevLink&&(e=React.createElement("a",{href:this.props.prevLink,onClick:this.handlePrevClick},"Novšie")),this.props.nextLink&&(t=React.createElement("a",{href:this.props.nextLink,onClick:this.handleNextClick},"Staršie")),React.createElement("nav",{className:"box-pager left"},e,t)}}),TopicBox=React.createClass({displayName:"TopicBox",getInitialState:function(){return{title:"",items:[],prevLink:null,nextLink:null,url:null,actualInterval:0,isLoading:!1,message:null,messageType:null,cacheUpdateInternal:6e4}},componentDidMount:function(){this.setState({actualInterval:this.props.refreshInterval}),this.downloadItems(this.getUrl())},downloadItems:function(e){var t=parseInt(this.props.refreshInterval/2);this.setState({isLoading:!0}),reqwest({url:e,timeout:t,dataType:"json",cache:!1,crossOrigin:!0,success:function(e){if(void 0===e.data||void 0===e.data.title||void 0===e.data.items)return this.setState({isLoading:!1,messageType:"error",message:"Nastal problem pri komunikacii so serverom"}),void this.setupNextTic();var t=e.data.items.data.map(function(e){return{id:e.id,published_at:e.published_at,title:e.title,text:e.bodytext,time_identifier:e.time_identifier,is_highlight:e.is_highlight,is_pinned:e.is_pinned,is_published:e.is_published}}),s=null,r=null;void 0!==e.data.items.meta.cursor&&(s=e.data.items.meta.cursor.prev,r=e.data.items.meta.cursor.next,this.setState({prevLink:s,nextLink:r})),this.actualizeItems(t,{title:e.data.title},s,r),0!=this.refreshInterval&&(this.lastUpdate=new Date,this.setupNextTic()),this.setState({isLoading:!1}),"error"==this.state.messageType&&(this.setState({message:"Spojenie bolo obnovene...",messageType:"info"}),setTimeout(function(){"info"==this.state.messageType&&this.setState({message:null,messageType:null})}.bind(this),3e3))}.bind(this),error:function(e,t,s){this.setupNextTic(),this.setState({isLoading:!1,messageType:"error",message:"Nastal problem pri komunikacii so serverom"})}.bind(this)})},setupNextTic:function(){0!=this.props.refreshInterval&&1!=this.props.showPager&&(this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(this.tic,1e3))},getUrl:function(){return this.state.url?this.state.url:(url=this.props.url+"/api/v1/topic?id="+this.props.topic,this.props.maxItems&&(url=url+"&limit="+parseInt(this.props.maxItems)),this.lastUpdate&&(lastUpdateTime=this.lastUpdate.getTime(),this.state.cacheUpdateInternal&&(lastUpdateTime-=lastUpdateTime%this.state.cacheUpdateInternal),url=url+"&last_update="+lastUpdateTime),this.props.tags&&this.props.tags.forEach(function(e){url=url+"&tags[]="+e}),this.props.hidden&&(url+="&hidden=true"),url)},tic:function(){var e=this.state.actualInterval-1e3;e<=0?(e=this.props.refreshInterval,this.downloadItems(this.getUrl())):this.setupNextTic(),this.setState({actualInterval:e})},actualizeItems:function(e,t,s,r){var a=this.state.items;e.forEach(function(e){isNew=!0,a.forEach(function(t){t.id==e.id&&(isNew=!1,t.title=e.title,t.text=e.text,t.published_at=e.published_at,t.is_highlight=e.is_highlight,t.is_pinned=e.is_pinned,t.is_published=e.is_published)}),isNew&&a.push(e)}),a.sort(function(e,t){return e.is_pinned&&!t.is_pinned?-1:!e.is_pinned&&t.is_pinned?1:e.published_at<t.published_at?1:e.published_at>t.published_at?-1:0}),0!=this.props.maxItems&&(a=a.slice(0,this.props.maxItems)),this.setState({items:a,title:t.title,prevLink:s,nextLink:r})},onPrev:function(){this.setState({items:[],url:this.state.prevLink}),this.downloadItems(this.state.prevLink)},onNext:function(){this.setState({items:[],url:this.state.nextLink}),this.downloadItems(this.state.nextLink)},onActualize:function(){this.setState({actualInterval:this.props.refreshInterval}),this.downloadItems(this.getUrl())},render:function(){var e=!0;"undefined"!=typeof this.props.showRefreshButton&&(e=this.props.showRefreshButton);var t=!0;"undefined"==typeof this.props.showDateHeader&&0==this.props.showDateHeader&&(t=!1);var s=null,r=this.props.refreshInterval,a=null;return this.props.showPager?(s=React.createElement(Pager,{prevLink:this.state.prevLink,nextLink:this.state.nextLink,onPrev:this.onPrev,onNext:this.onNext}),r=0):a=React.createElement(RefreshBox,{isLoading:this.state.isLoading,message:this.state.message,messageType:this.state.messageType,onActualize:this.onActualize,url:this.state.url,topic:this.props.topic,refreshInterval:r,showRefreshButton:e,actualTime:this.state.actualInterval,onItems:this.actualizeItems,limit:this.props.maxItems}),React.createElement("div",null,React.createElement("header",null,React.createElement("h1",{id:"m-header"},this.state.title),a),React.createElement("div",{className:"minutes"},React.createElement(ItemListBox,{items:this.state.items,showDateHeader:t,showControls:this.props.showControls,editUrl:this.props.editUrl,deleteUrl:this.props.deleteUrl,callbacks:this.props.callbacks,activeItem:this.props.activeItem})),s)}});